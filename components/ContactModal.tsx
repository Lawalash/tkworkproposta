import React, { useState } from 'react';
import { X, FileText, Download, CheckCircle2, AlertCircle, MessageCircle } from 'lucide-react';

const CONTRACT_TEXT = `CONTRATO DE PRESTAÇÃO DE SERVIÇOS – INTEGRAÇÃO DIGITAL

1. DAS PARTES

CONTRATANTE:
Kethelen Kaylanne Galdino Ferreira do Nascimento, CPF 714.297.854-62, doravante denominada CONTRATANTE.

CONTRATADO:
Ricardo Alexandre Brasil Júnior, brasileiro, maior, autônomo pessoa física, CPF 70490814425, doravante denominado CONTRATADO.

2. DO OBJETO

2.1. O presente instrumento tem por objeto a prestação de serviços de integração digital entre as plataformas Bling, Nuvemshop e Shopee da CONTRATANTE, incluindo configuração, testes e treinamento inicial de uso.

2.2. O objetivo do projeto é centralizar estoque, pedidos e catálogo em um único fluxo, reduzindo retrabalho, evitando furos de estoque e preparando a operação da CONTRATANTE para crescimento estruturado.

3. DO ESCOPO DOS SERVIÇOS

3.1. O CONTRATADO se compromete a executar, no mínimo, as seguintes atividades:
a) Mapeamento da operação atual da CONTRATANTE, com entendimento de processos de cadastro, vendas e controle de estoque;
b) Configuração inicial do Bling para gestão de produtos, estoque e pedidos;
c) Integração Bling ↔ Nuvemshop, com sincronização de produtos e estoque, conforme recursos disponíveis na plataforma;
d) Integração Bling ↔ Shopee, com sincronização de produtos e estoque, conforme recursos disponíveis na plataforma;
e) Realização de testes práticos com produtos piloto e simulação de vendas para validação do fluxo;
f) Ajustes pontuais decorrentes dos testes, dentro do escopo inicialmente definido;
g) Treinamento inicial com a CONTRATANTE, focado no uso básico do fluxo implementado (cadastro de produtos, acompanhamento de pedidos, visão de estoque), em encontros online ou presenciais, a serem definidos em comum acordo.

3.2. Qualquer atividade fora desse escopo (como novas integrações, automações adicionais, relatórios avançados ou reestruturações significativas nas plataformas) será considerada serviço adicional e deverá ser previamente discutida e aprovada entre as partes, com orçamento próprio ou aditivo.

4. DAS ENTREGAS, PRAZOS E TREINAMENTO

4.1. A data de entrega do projeto (go-live) será ajustada em comum acordo entre as partes, levando em consideração:
– tempo necessário para configuração e integrações;
– disponibilidade da CONTRATANTE para testes;
– agendamento dos encontros de treinamento.

4.2. Entende-se por entrega do projeto (go-live) o momento em que:
a) o fluxo Bling ↔ Nuvemshop ↔ Shopee estiver configurado e funcional para operação real;
b) tiverem sido realizados os testes acordados;
c) a CONTRATANTE tiver recebido o treinamento inicial previsto na cláusula 3.

4.3. Etapas adicionais de treinamento, que extrapolem o conteúdo e a carga prevista no treinamento inicial (por exemplo, treinamentos para novas pessoas da equipe ou aprofundamentos em áreas não cobertas no escopo), serão tratadas como serviços adicionais, com valores a combinar.

5. DO VALOR E FORMA DE PAGAMENTO

5.1. O valor de referência do projeto é composto por:
– Valor do projeto: R$ 1.349,07;
– Taxa de implementação (35%): R$ 472,17.

5.2. Para efeitos práticos de fluxo de caixa e parcelamento, as partes acordam que o valor total a ser pago ao CONTRATADO será de R$ 2.044,10, valor que já contempla o projeto, a taxa de implementação e encargos de parcelamento.

5.3. A forma de pagamento acordada é a seguinte:
a) A CONTRATANTE pagará ao CONTRATADO parcelas mensais de R$ 204,41;
b) O dia do pagamento será definido com base na data de entrega (go-live): se o projeto for entregue, por exemplo, no dia 10, as próximas parcelas terão vencimento todo dia 10 de cada mês, salvo ajuste em comum acordo caso recaia em feriados ou finais de semana;
c) Até o 4º (quarto) mês, os pagamentos serão feitos diretamente ao CONTRATADO (por PIX, transferência bancária ou outro meio acordado);
d) No 5º (quinto) mês, será cobrado, via cartão de crédito, o saldo remanescente do valor total do projeto, sendo facultado à CONTRATANTE parcelar esse saldo diretamente com a operadora do cartão, conforme condições e juros praticados pela instituição financeira;
e) Quaisquer juros, tarifas ou encargos cobrados pela operadora de cartão na operação descrita na alínea "d" correrão por conta da CONTRATANTE.

5.4. O não pagamento de qualquer parcela na data ajustada poderá implicar, a critério do CONTRATADO:
a) suspensão temporária de suporte e atividades relacionadas ao projeto;
b) atualização do valor em aberto com correção monetária e/ou multa e juros a serem ajustados entre as partes, caso necessário;
c) negociação de novo cronograma de pagamentos.

6. DA MANUTENÇÃO, AJUSTES E MELHORIAS FUTURAS

6.1. A presente proposta não inclui manutenção contínua após a estabilização inicial, salvo o acompanhamento já previsto no escopo até o go-live.

6.2. Manutenções corretivas pontuais, dentro do que foi configurado originalmente e relacionadas a falhas diretamente ligadas à implementação do CONTRATADO, serão avaliadas caso a caso, sem custo adicional quando se tratar de erro do próprio trabalho executado.

6.3. Treinamentos adicionais, ajustes nas plataformas que extrapolem o escopo inicial, novas automações, novas integrações, relatórios avançados ou qualquer melhoria estrutural deverão:
a) ser discutidos previamente entre as partes;
b) ter novo orçamento ou aditivo de contrato definido;
c) ser pagos de forma apartada ou, se acordado entre as partes, com reajuste no valor das parcelas futuras.

7. DAS RESPONSABILIDADES DA CONTRATANTE

7.1. A CONTRATANTE se compromete a:
a) disponibilizar, em tempo hábil, acessos, logins, senhas e permissões necessários às plataformas envolvidas (Bling, Nuvemshop, Shopee e demais serviços);
b) fornecer informações atualizadas e verdadeiras sobre produtos, preços, estoque e políticas comerciais;
c) participar ativamente dos testes e do treinamento, informando ao CONTRATADO eventuais problemas encontrados;
d) cumprir os prazos de pagamento estabelecidos na cláusula 5.

8. DAS RESPONSABILIDADES DO CONTRATADO

8.1. O CONTRATADO se compromete a:
a) executar os serviços com zelo, cuidado técnico e boa-fé;
b) manter a CONTRATANTE atualizada sobre o andamento do projeto;
c) tratar de forma confidencial os acessos e informações fornecidos pela CONTRATANTE, utilizando-os exclusivamente para execução do projeto;
d) entregar o projeto conforme o escopo estabelecido neste instrumento.

9. DA CONFIDENCIALIDADE

9.1. Ambas as partes se obrigam a manter sigilo sobre dados, estratégias, senhas, relatórios e quaisquer informações sensíveis às quais tenham acesso em razão deste contrato, não podendo repassá-las a terceiros sem autorização expressa da outra parte.

10. DA VIGÊNCIA E RESCISÃO

10.1. Este contrato entra em vigor na data da aceitação da proposta pela CONTRATANTE e permanece vigente até a conclusão do projeto e quitação integral dos valores pactuados.

10.2. O contrato poderá ser rescindido por qualquer das partes, mediante comunicação prévia, preferencialmente por escrito (WhatsApp, e-mail), sendo feito acerto proporcional dos valores referentes às etapas já executadas.

11. DISPOSIÇÕES GERAIS

11.1. Este instrumento tem caráter de proposta/contrato simplificado entre pessoas físicas, não substituindo eventual contrato formal elaborado por profissional jurídico, caso as partes assim desejem.

11.2. Os casos omissos serão resolvidos de comum acordo entre CONTRATANTE e CONTRATADO.`;

const WHATSAPP_NUMBER = '5583993725984';

interface ContactModalProps {
  isOpen: boolean;
  type: 'approval' | 'doubt';
  onClose: () => void;
}

const ContactModal: React.FC<ContactModalProps> = ({ isOpen, type, onClose }) => {
  const [hasAccepted, setHasAccepted] = useState(false);
  const [showError, setShowError] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  if (!isOpen) return null;

  const handleDownloadContract = () => {
    const blob = new Blob([CONTRACT_TEXT], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'contrato-twork.txt';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  };

  const handleSendApproval = () => {
    if (!hasAccepted) {
      setShowError(true);
      setTimeout(() => setShowError(false), 4000);
      return;
    }

    const message = encodeURIComponent(
      'Olá, confirmo que li e aceito a proposta de Integração Digital Twork, no valor de R$ 2.044,10, com parcelas mensais de R$ 204,41, conforme contrato enviado. A data de pagamento será contada a partir da entrega (go-live) acordada em conjunto.'
    );

    window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${message}`, '_blank');

    setTimeout(() => {
      window.open(`https://wa.me/558389060130?text=${message}`, '_blank');
    }, 500);

    setShowSuccess(true);
  };

  const handleDoubtContact = () => {
    const message = encodeURIComponent('Olá! Tenho algumas dúvidas sobre a proposta de Integração Digital Twork. Poderia me ajudar?');
    window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${message}`, '_blank');
  };

  if (type === 'doubt') {
    return (
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div
          className="absolute inset-0 bg-slate-900/70 backdrop-blur-sm"
          onClick={onClose}
        />

        <div className="relative bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8 transform transition-all">
          <button
            onClick={onClose}
            className="absolute top-6 right-6 text-slate-400 hover:text-slate-600 transition-colors"
          >
            <X size={24} />
          </button>

          <div className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-50 border border-blue-200 text-blue-700 text-xs font-bold uppercase tracking-wider mb-4">
              <MessageCircle size={14} />
              Tire suas dúvidas
            </div>
            <h2 className="text-3xl font-black text-slate-900 mb-3">Estamos aqui para ajudar</h2>
            <p className="text-slate-600 leading-relaxed">
              Entre em contato conosco pelo WhatsApp e responderemos todas as suas perguntas sobre a proposta.
            </p>
          </div>

          <button
            onClick={handleDoubtContact}
            className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-[#043959] via-[#466FA6] to-[#AD8DF2] text-white font-bold text-lg py-5 px-6 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300"
          >
            <MessageCircle size={22} />
            Falar pelo WhatsApp
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 overflow-y-auto">
      <div
        className="absolute inset-0 bg-slate-900/70 backdrop-blur-sm"
        onClick={!showSuccess ? onClose : undefined}
      />

      <div className="relative bg-white rounded-3xl shadow-2xl max-w-3xl w-full my-8 transform transition-all">
        <button
          onClick={onClose}
          className="absolute top-6 right-6 text-slate-400 hover:text-slate-600 transition-colors z-10"
        >
          <X size={24} />
        </button>

        {!showSuccess ? (
          <div className="p-8 md:p-10">
            <div className="text-center mb-8">
              <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 text-purple-700 text-xs font-bold uppercase tracking-wider mb-4">
                <FileText size={14} />
                Aprovação de Proposta
              </div>
              <h2 className="text-3xl md:text-4xl font-black text-slate-900 mb-3">
                Confirmação da Proposta – Twork
              </h2>
              <p className="text-slate-600 leading-relaxed max-w-2xl mx-auto">
                Antes de seguir com a aprovação, leia atentamente os termos do contrato e confirme seu aceite.
              </p>
            </div>

            <div className="mb-6">
              <button
                onClick={handleDownloadContract}
                className="w-full flex items-center justify-center gap-3 py-4 px-6 rounded-2xl border-2 border-[#466FA6] text-[#466FA6] font-bold hover:bg-[#466FA6] hover:text-white transition-all duration-300 group"
              >
                <Download size={20} className="group-hover:animate-bounce" />
                Baixar contrato completo (.txt)
              </button>
            </div>

            <div className="mb-6">
              <h3 className="text-lg font-bold text-slate-900 mb-3 flex items-center gap-2">
                <FileText size={20} className="text-[#466FA6]" />
                Termos do Contrato
              </h3>
              <div className="h-72 overflow-y-auto bg-white border-2 border-slate-200 rounded-2xl p-6 text-sm text-slate-800 leading-relaxed whitespace-pre-wrap shadow-inner">
                {CONTRACT_TEXT}
              </div>
            </div>

            <div className="space-y-6">
              <div className="bg-gradient-to-br from-blue-50 to-purple-50 border-2 border-purple-200 rounded-2xl p-6">
                <label className="flex items-start gap-4 cursor-pointer group">
                  <input
                    type="checkbox"
                    checked={hasAccepted}
                    onChange={(e) => {
                      setHasAccepted(e.target.checked);
                      setShowError(false);
                    }}
                    className="mt-1 w-5 h-5 rounded border-2 border-slate-300 text-[#466FA6] focus:ring-2 focus:ring-[#466FA6]/20 cursor-pointer"
                  />
                  <span className="flex-1 font-semibold text-slate-900 group-hover:text-[#466FA6] transition-colors">
                    Declaro que li e estou de acordo com os termos deste contrato.
                  </span>
                </label>
                <p className="text-xs text-slate-600 mt-3 ml-9 leading-relaxed">
                  Ao marcar esta opção e encaminhar a resposta, você formaliza digitalmente sua aprovação da proposta.
                </p>
              </div>

              {showError && (
                <div className="flex items-center gap-3 text-sm text-red-700 bg-red-50 border-2 border-red-200 rounded-2xl px-4 py-3 animate-shake">
                  <AlertCircle className="text-red-500 flex-shrink-0" size={18} />
                  <span className="font-medium">
                    Você precisa confirmar que leu e aceita os termos para prosseguir.
                  </span>
                </div>
              )}

              <button
                onClick={handleSendApproval}
                className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-[#466FA6] via-[#AD8DF2] to-[#B79BF2] text-white font-black text-lg py-5 px-6 rounded-2xl shadow-2xl shadow-purple-300/50 hover:shadow-3xl hover:scale-105 transition-all duration-300"
              >
                <CheckCircle2 size={22} />
                Encaminhar resposta
              </button>
            </div>
          </div>
        ) : (
          <div className="p-8 md:p-10 text-center">
            <div className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-green-400 to-emerald-500 mb-6 animate-bounce">
              <CheckCircle2 size={40} className="text-white" />
            </div>
            <h3 className="text-3xl font-black text-slate-900 mb-4">
              Aprovação Encaminhada!
            </h3>
            <p className="text-slate-600 leading-relaxed mb-8 max-w-md mx-auto">
              Agradecemos, sua aprovação foi encaminhada com sucesso. Em breve retornaremos com os próximos passos.
            </p>
            <button
              onClick={onClose}
              className="px-8 py-3 bg-gradient-to-r from-[#466FA6] to-[#AD8DF2] text-white font-bold rounded-xl hover:scale-105 transition-all duration-300"
            >
              Fechar
            </button>
          </div>
        )}
      </div>

      <style>{`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .animate-shake {
          animation: shake 0.3s ease-in-out;
        }
      `}</style>
    </div>
  );
};

export default ContactModal;
